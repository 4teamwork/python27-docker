Hardening around not_resumable sessions

Make sure we can't inadvertently use a not_resumable session

Related to CVE-2024-2511
Backported from https://github.com/openssl/openssl/pull/24044

diff --git a/ssl/ssl_sess.c b/ssl/ssl_sess.c
index 2c258a2d83..5e9553cfa8 100644
--- a/ssl/ssl_sess.c
+++ b/ssl/ssl_sess.c
@@ -453,6 +453,12 @@ SSL_SESSION *lookup_sess_in_cache(SSL *s, const unsigned char *sess_id,
         ret = s->session_ctx->get_session_cb(s, sess_id, sess_id_len, &copy);
 
         if (ret != NULL) {
+            if (ret->not_resumable) {
+                /* If its not resumable then ignore this session */
+                if (!copy)
+                    SSL_SESSION_free(ret);
+                return NULL;
+            }
             tsan_counter(&s->session_ctx->stats.sess_cb_hit);
 
             /*
